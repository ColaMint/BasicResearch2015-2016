Lession-1 玩转Linux
===================

Linux从开机到桌面启动，经历过什么事情？
---------------------------------------

#. 系统开机，加电自检，针对计算机硬件如CPU、主板、存储器等进行检测，结果会显示在固件可以控制的输出界面
#. 固件引导
    * BIOS
       #. BIOS初始化一些引导过程中必要的硬件，比如硬盘和键盘等。
       #. BIOS针对所选择的硬盘（可能由BIOS启动顺序决定，也可能是人工选择），执行位于硬盘上的起始位置的主引导记录（MBR）的主引导程序。
       #. 由于主引导程序的长度受到限制，因此一般情况下主引导程序还负责找到位于活动分区上的次引导程序并执行它。
    * UEFI
       #. UEFI初始化启动要用的硬件比如硬盘和键盘等。
       #. UEFI通过启动管理器来决定从哪一个设备进行启动。UEFI启动管理器是一种固件策略引擎，可通过efibootmgr修改固件架构中定义的全局NVRAM变量进行配置。启动管理器将尝试按全局NVRAM变量定义的顺序依次加载UEFI驱动和UEFI应用程序。
       #. 在选择好启动设备后，有三种情况:如果选择的是一个BIOS兼容启动项，那么UEFI启动管理器会出发指定设备以BIOS方式启动；如果选择的是一个回退路径（Fallback Path）UEFI原生启动项， UEFI固件会查找 EFI系统分区（ESP）中的\\EFI\\BOOT\\BOOT{计算机类型简称}.EFI的启动装载程序来负责剩余的启动过程；如果选择的是一个完全原生UEFI启动项（指定了启动引导器的位置），UEFI固件会直接执行该启动引导程序完成剩余的启动过程。
#. 启动引导器会根据配置文件，将内核镜像和initramfs加载到内存中，并将 initramfs 挂在为一个临时的根目录。 initramfs 中包含了各种可执行程序和驱动程序，用来为挂在真正的根文件系统提供支持。内核初始化后切换到用户空间执行/init程序，在udev之类的程序加载好模块之后，真正的根文件系统被挂在，并替换掉原本的临时根原件系统然后执行真正跟文件系统上的init程序。
#. init进程执行一些系统初始化脚本（/etc/rc.d/rc.sysinit，/etc/rc.d/rc，/etc/rc.d/rc.local）,然后为每一个虚拟终端fork一个进程执行getty程序，每个虚拟终端会初始化tty并请求输入用户名。当输入用户名之后，getty程序会exec login程序要求用户输入密码，login程序会通过/etc/passwd检查是否正确，如果正确，就初始化用户环境并应通过exec用/etc/passwd中指定的shell来替换自己。否则以一个返回码告知init进程，init进程会重复同样的步骤直到用户登录成功。
#. 用户登录成功后，可通过startx或xinit启动桌面管理器或桌面环境。桌面管理器或桌面环境通过X协议与X-Server通信来实现图像的绘制，并在上面运行X程序。
